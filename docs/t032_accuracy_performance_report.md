# T032 정확도·성능 분석 보고서

## 1. 실행 요약
- 기준 문서: `docs/prd.md` (중복 섹션 제거 및 메타데이터 상단 이동 완료)
- 수행 작업
  - 정확도 검증: `pytest tests/verification/test_accuracy.py` (7/7 테스트 통과)
  - 성능 측정: `pytest tests/performance --benchmark-only --benchmark-json perf_results.json`
- 측정 환경: Python 3.12.3, pytest-benchmark 5.1.0, Intel Xeon Gold 5220 (단일 vCPU)

## 2. 정확도 검증 현황
- 커버리지: RV64I ALU 5종, Load/Store 2종, 버스 연동 시나리오 1종 (총 7 케이스)
- 결과: 모든 케이스에서 레퍼런스 엔진(`ReferenceRISCVEngine`)과 레지스터 상태/메모리 상태 동일
- 한계:
  - 분기/점프, NPU, 이벤트 기반(Lev1) 흐름은 아직 검증 대상에 포함되지 않음
  - 장시간 실행이나 복합 워크로드 정밀도(±15% 목표) 검증 데이터 부재

## 3. 마이크로 벤치마크 성능 요약
(pytest-benchmark 측정, 단위: 평균 실행 시간 ns / 백만 연산당 처리량)

| 범주 | 벤치마크 | 평균(ns) | 처리량(Mops/s) | 비고 |
| --- | --- | --- | --- | --- |
| ALU | ADD | 115.73 | 8.64 | 단일 명령 호출 기준 |
|  | SUB | 114.62 | 8.72 |  " |
|  | AND | 119.73 | 8.35 |  " |
|  | OR | 118.24 | 8.46 |  " |
|  | XOR | 118.54 | 8.44 |  " |
| Control Flow | BEQ | 135.81 | 7.36 | 분기 조건 평가 + PC 업데이트 |
|  | BNE | 144.05 | 6.94 |  " |
|  | JAL | 212.25 | 4.71 | 링크 레지스터 기록 포함 |
|  | JALR | 168.80 | 5.92 |  " |
| NPU 벡터 | v_add | 9,239.85 | 0.11 | 1024 요소 NumPy 연산 |
|  | v_sub | 9,305.19 | 0.11 |  " |
|  | v_mul | 9,985.61 | 0.10 |  " |
|  | v_div | 10,799.12 | 0.09 | 0 처리 회피용 재가공 포함 |

- 메모리 벤치마크(ld/sd/lw/sw)는 `bytearray` 픽스처가 `read`/`write`를 제공하지 않아 실패 → `Bus` 객체로 교체 필요
- 측정치는 함수 단위 호출 성능이며, 전체 시뮬레이터 MIPS와 직접적으로 대응되지 않음

## 4. PRD 목표 대비 현황

| 구분 | PRD 목표 | 현재 상태 | 평가 |
| --- | --- | --- | --- |
| 시뮬레이션 속도 | Week 12: 12-20 MIPS | 전체 파이프라인 벤치마크 미수행. 함수 단위 측정치만 존재 (최대 ~8.7 Mops/s) | ⚠️ 미충족 (측정 인프라 부족) |
| 정확도 | ±15% 이내 (골든 대비) | 단일 명령 단위 정확성 검증 PASS (7 케이스). 복합 워크로드/장시간 정확도 미측정 | ⚠️ 부분 충족 |
| 사이클 정확 대비 속도 | 50-200배 | 비교 대상(gem5 등)과의 상대 측정 미수행 | ⚠️ 미측정 |
| 메모리 사용량 | 6GB → 4GB | 런타임 메모리 프로파일링 미수행 | ⚠️ 미측정 |
| 테스트 커버리지 | 단위 70% / 통합 20% / 성능 10% | 정확도·성능 테스트는 존재하나 커버리지 통계 미출력 | ⚠️ 미측정 |

## 5. 식별된 격차 및 후속 조치안
1. **전체 시뮬레이터 MIPS 측정 도구 부재**
   - `src/simulator/main.py` 경량 workload + 타이머 계측 추가 필요
   - PRD 목표(5/8/12 주차 단계별 목표) 대비 실제 값 추적할 대시보드 권장
2. **메모리 벤치마크 실패**
   - `tests/performance/test_performance.py` 픽스처를 `Bus` 객체로 교체하거나 `bytearray`에 어댑터 제공
   - Store/Load 성능 데이터 확보 후 PRD 표(≥6 MIPS 등)와 비교
3. **정확도 범위 확장**
   - 분기/점프/멀티 인스트럭션 시나리오, NPU 명령 흐름, Lev1 이벤트 경로에 대한 레퍼런스 대비 평가 필요
   - ±15% 정확도 정의(예: 사이클 지연? 실행 시간?)를 명확히 하고 샘플 워크로드 선택
4. **장시간 안정성·메모리 사용량 측정**
   - 장시간 실행 스크립트 및 memory_profiler/cProfile 기반 레포트 생성
5. **성과 추적 문서화**
   - 위 항목이 정리되면 `docs/prd.md`의 목표 표에 실제 수치를 병기하고, CI에서 주기적으로 갱신하도록 자동화 고려

## 6. 산출물
- `docs/prd.md`: 중복 섹션 제거 및 메타데이터 정리
- `docs/t032_accuracy_performance_report.md`: 본 문서
- pytest-benchmark 원시 데이터(`perf_results.json`)는 로컬 실행 시 생성되며, 저장소에는 포함하지 않음 (필요 시 재생성)
